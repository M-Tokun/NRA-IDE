

# **05_coherence_gate.md — コヒーレンスゲート（Coherence Gate）**

## 🧭 はじめに

コヒーレンスゲート（Coherence Gate）は、  
NRA‑IDE の安全性を支える **三層構造の中心的装置**です。

その役割はただ一つ：

> **ゆらぎ（δ）と厚み（τ）の比率 R = δ/τ を監視し、  
> 構造破断の兆候を検出して Fail‑Closed を発動すること。**

コヒーレンスゲートは意味（Semantic）を扱わず、  
**構造（Structure）だけを監査**します。

---

# 🎯 1. コヒーレンスゲートの目的

コヒーレンスゲートの目的は次の通りです：

- **構造逸脱（violation）を早期に検出する**  
- **破断前に沈黙（Fail‑Closed）する**  
- **意味ではなく構造で安全性を保証する**  
- **最適化やスコア依存を完全に排除する**

これにより、  
従来の「意味ベースの安全性」では不可能だった  
**構造的安全性（Structural Safety）** が実現します。

---

# 🎯 2. 三層構造（Three-Layer Model）

コヒーレンスゲートは、  
ゆらぎ（δ）と厚み（τ）の比率 R = δ/τ に基づいて  
**三層の安全領域**を定義します。

```
R = δ / τ
```

---

## **Layer 1：Coherent（R < 0.4）**

```
R < 0.4
```

- ゆらぎが小さく、構造は安定  
- 出力は許可される  
- 緊張（Tension）はゼロ  
- 破断の兆候なし  

**状態：安全**

---

## **Layer 2：Tension（0.4 ≤ R < 1.0）**

```
0.4 ≤ R < 1.0
```

- ゆらぎが増加  
- 構造に緊張が生じる  
- 出力は許可されるが、監視が強化される  
- 破断の前兆が存在する  

**状態：注意**

---

## **Layer 3：Fracture（R ≥ 1.0）**

```
R ≥ 1.0
```

- ゆらぎが厚みを超えた  
- 構造破断（Fracture）が発生  
- 即座に Fail‑Closed  
- 熱廃棄ログを記録  
- 出力は沈黙（Silence）  

**状態：停止（Fail‑Closed）**

---

# 🎯 3. コヒーレンスゲートの内部構造

```
CoherenceGate
├── measureFluctuation()   → δ
├── measureThickness()     → τ
├── computeRatio()         → R = δ/τ
├── detectTension()        → Layer 2 判定
├── detectFracture()       → Layer 3 判定
└── triggerFailClosed()    → 沈黙 + 熱廃棄ログ
```

---

# 🎯 4. コヒーレンスゲートが扱うもの・扱わないもの

## ✔ 扱う（因果的に定義可能）

- δ（ゆらぎ）  
- τ（厚み）  
- R（比率）  
- ω（角速度）  
- violation（逸脱量）  

---

## ❌ 扱わない（Effect / Semantic）

- 意味（Semantic）  
- 距離  
- スコア  
- 座標  
- 目標位置  
- 過去出力  
- 評価値  

コヒーレンスゲートは **意味を一切扱わない** ため、  
モデル依存の安全性問題を完全に排除できます。

---

# 🎯 5. コヒーレンスゲートが必要な理由

### ✔ 1. 幻覚（Hallucination）を構造的に検出できる  
意味ではなく構造の破断として扱う。

### ✔ 2. 最適化の暴走を防ぐ  
距離・スコアを扱わないため、  
Goodhart の法則が発動しない。

### ✔ 3. モデル非依存  
どの LLM にも適用可能。

### ✔ 4. Fail‑Closed の発動点を明確化  
R ≥ 1.0 で即時停止。

### ✔ 5. 熱廃棄ログとの連携  
破断直前の構造情報を記録できる。

---

# 🎯 6. 実装上の注意

コヒーレンスゲートを実装する際は、  
以下を必ず守る必要があります：

- 意味解析を行わない  
- 距離・スコアを扱わない  
- R = δ/τ の計算は必須  
- R ≥ 1.0 で必ず Fail‑Closed  
- 熱廃棄ログを記録する  
- LLM の内部状態に依存しない  

これらを破ると、  
NRA‑IDE は **構造破断** を起こします。

---

# 🎯 7. コヒーレンスゲートの本質

コヒーレンスゲートの本質は次の一文に集約されます：

> **「意味ではなく、ゆらぎと厚みの比率で安全性を判断する。」**

これは NRA‑IDE の思想そのものです。

