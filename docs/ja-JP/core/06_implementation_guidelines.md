
# **06_implementation_guidelines.md  
実装ガイドライン（Implementation Guidelines）**

## 0. はじめに

本章では、NRA‑IDE を実際のシステムに組み込むための  
**実装ガイドライン**を定義する。

対象読者は以下の通り：

- システムアーキテクト  
- 実装エンジニア  
- 安全クリティカル領域の開発者  
- LLM 統合担当者  

本章は **実装のための最低限の要件**を示すものであり、  
詳細な構造は 03（構造大全）を参照する。

---

# **1. 三層構造の実装要件（RNA Sandwich Implementation）**

NRA‑IDE は **Pre‑RNA / LLM / Post‑RNA** の三層構造で動作する。  
実装者はこの三層を **物理的・論理的に分離**しなければならない。

## 1.1 Pre‑RNA の実装要件
- 入力を因果単位 δ に分解する  
- 意味解析を行わない  
- LLM に渡す前に構造を整える  
- 入力の正規化は行ってもよいが、意味補完は禁止  
- 過去の出力を参照しない  

## 1.2 LLM の実装要件
- 意味生成のみを担当  
- 安全性は担当しない  
- LLM の出力は必ず Post‑RNA に渡す  
- LLM が Pre‑RNA や Post‑RNA の内部状態にアクセスしてはならない  

## 1.3 Post‑RNA の実装要件
- LLM 出力を因果構造として再評価  
- R(δ/τ) を計算  
- R ≥ R_op なら破断 → SILENCE  
- Discard Log を記録  
- 意味解析を行わない  
- LLM にフィードバックを返さない  

---

# **2. Box サンドイッチ構造の実装（Curtain 禁止）**

## 2.1 Curtain 構造の禁止
以下のような構造は **Curtain** とみなされ、禁止される：

- Pre‑RNA と LLM が同一プロセス  
- Post‑RNA が LLM の内部状態を参照  
- LLM が Post‑RNA の判断を利用  
- 双方向のデータ流通が可能  

これらは **構造侵食（Structure Erosion）** を引き起こす。

## 2.2 Box 構造の実装要件
- Pre‑RNA / LLM / Post‑RNA を別プロセスまたは別コンテナに分離  
- API 境界を固定し、双方向通信を禁止  
- LLM の内部状態を外部に出さない  
- Post‑RNA の判断を LLM に返さない  
- 意味データを構造層に渡さない  

## 2.3 推奨実装
- Pre‑RNA：軽量な構造抽出モジュール  
- LLM：外部 API または隔離された推論サーバ  
- Post‑RNA：独立した安全評価モジュール  
- 3 層間は **構造データのみ** を渡す

---

# **3. Fail‑Closed の実装（Silence Handling）**

## 3.1 SILENCE の実装要件
- 破断時は **空出力**または **固定トークン**を返す  
- 補完しない  
- 修正しない  
- LLM に戻さない  
- 意味で埋めない  

## 3.2 再試行の扱い
- 再試行は人間が判断する  
- 自動再試行は禁止  
- 再試行時に履歴を参照してはならない  

---

# **4. Discard Log の実装**

## 4.1 記録要件
- R（破断直前）  
- δ の断片（snapshot）  
- タイムスタンプ  

## 4.2 禁止事項
- 意味解釈  
- 改善への利用  
- モデル評価への利用  
- 外部公開  

## 4.3 保存要件
- 保存期間は短くする  
- 暗号化して保存する  
- 外部システムと共有しない  

---

# **5. Domain Tuning の実装**

## 5.1 τ（厚み）の設定
- 領域のリスクに応じて設定  
- 医療・航空は厚く  
- 産業は中厚  
- クリエイティブは使用禁止  

## 5.2 R_op（運用閾値）の設定
- 低く設定するほど安全  
- 高く設定すると沈黙が減るが危険  
- デフォルトは「沈黙しやすい値」にする  

---

# **6. 責任境界の実装**

## 6.1 人間の責任
- 意味判断  
- 文脈判断  
- 最終判断  
- リスク判断  

## 6.2 システムの責任
- 因果構造の破断検出  
- Fail‑Closed  
- Discard Log の記録  

## 6.3 境界の固定
- LLM の出力をそのまま人間に渡す  
- NRA‑IDE は構造だけを評価  
- LLM と NRA‑IDE の責任を混ぜない  

---

# **7. テスト要件（Implementation Testing Requirements）**

## 7.1 必須テスト
- 破断テスト  
- 逆流テスト（Backflow Test）  
- Curtain 構造検出テスト  
- τ と R_op の領域別テスト  
- Fail‑Closed の動作確認  

## 7.2 禁止テスト
- 意味評価テスト  
- 自然さテスト  
- 一貫性テスト  
- 改善テスト  

---

# **8. 本質**

> **「NRA‑IDE の実装は、  
>  “意味を混ぜないための構造” を作る行為である。」**
